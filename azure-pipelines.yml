trigger:
  branches:
    include:
      - master   # Change to your branch

pool:
  vmImage: 'Default'

variables:
  node_version: '22.x'
  build_folder: 'build'

steps:
# 1️⃣ Checkout code
- task: Checkout@1

# 2️⃣ Use Node 22
- task: NodeTool@0
  inputs:
    versionSpec: '$(node_version)'
  displayName: 'Use Node $(node_version)'

# 3️⃣ Install dependencies
- script: |
    npm install
  displayName: 'Install dependencies'

# 4️⃣ Build React Router SSR
- script: |
    npm run build
  displayName: 'Build SSR app'

# 5️⃣ Archive files for deployment
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.SourcesDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(Build.ArtifactStagingDirectory)/app.zip'
    replaceExistingArchive: true
  displayName: 'Zip source for deployment'

# 6️⃣ Publish artifact (optional, useful for debugging)
- publish: $(Build.ArtifactStagingDirectory)/app.zip
  artifact: drop

# 7️⃣ Deploy to Azure App Service
- task: AzureWebApp@1
  inputs:
    azureSubscription: 'Vinay-Azure-Connection'
    appType: 'webApp'  # or 'webApp' for Windows
    appName: 'credManager'
    package: '$(Build.ArtifactStagingDirectory)/app.zip'
    startupCommand: 'npm start'
